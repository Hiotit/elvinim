<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Kutuyu Aç</title>
<style>
  body, html {
    margin:0; padding:0; overflow:hidden; background:#111;
    font-family: Arial, sans-serif;
  }
  #openBtn {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 16px 36px;
    font-size: 22px;
    font-weight: bold;
    color: white;
    background: #1e88e5;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    z-index: 10;
    box-shadow: 0 0 15px #1976d2aa;
    transition: background 0.3s;
  }
  #openBtn:hover:not(:disabled) {
    background: #42a5f5;
  }
  #openBtn:disabled {
    background: #555;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<button id="openBtn">Kutuyu Aç</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
(() => {
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x111111);

  const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0, 2, 5);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.1;

  // Işıklar
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
  directionalLight.position.set(5, 10, 7);
  directionalLight.castShadow = true;
  scene.add(directionalLight);

  // Zemin
  const floorGeo = new THREE.PlaneGeometry(15, 15);
  const floorMat = new THREE.ShadowMaterial({opacity:0.3});
  const floor = new THREE.Mesh(floorGeo, floorMat);
  floor.rotation.x = -Math.PI / 2;
  floor.position.y = -0.5;
  floor.receiveShadow = true;
  scene.add(floor);

  // Kutu gövdesi
  const boxGeo = new THREE.BoxGeometry(2, 1.2, 2);
  const boxMat = new THREE.MeshStandardMaterial({color: 0x1565c0, metalness: 0.6, roughness: 0.3});
  const boxMesh = new THREE.Mesh(boxGeo, boxMat);
  boxMesh.castShadow = true;
  boxMesh.receiveShadow = true;
  scene.add(boxMesh);

  // Kutu kapağı (üst yüzeyden biraz kalın)
  const lidGeo = new THREE.BoxGeometry(2.05, 0.3, 2.05);
  const lidMat = new THREE.MeshStandardMaterial({color: 0x42a5f5, metalness: 0.7, roughness: 0.2});
  const lidMesh = new THREE.Mesh(lidGeo, lidMat);
  lidMesh.castShadow = true;
  lidMesh.position.y = 0.75;
  lidMesh.receiveShadow = true;
  scene.add(lidMesh);

  // Kapağın dönme noktası alt kenarı olsun diye pivot ayarlıyoruz
  const lidPivot = new THREE.Object3D();
  lidPivot.position.set(0, 0.6, 1);
  scene.add(lidPivot);
  lidPivot.add(lidMesh);
  lidMesh.position.set(0, 0.15, -1);

  // 3D Yazı için geometrik bir basit alternatif (kutunun içinden çıkacak)
  // Burada text yerine bir düzlem ve ışıklı malzeme kullanacağız (3D text için font dosyası vs gerekirdi)
  const textGeo = new THREE.PlaneGeometry(3, 0.8);
  const canvasText = document.createElement('canvas');
  canvasText.width = 1024;
  canvasText.height = 256;
  const ctx = canvasText.getContext('2d');

  function drawTextOnCanvas(text) {
    ctx.clearRect(0, 0, canvasText.width, canvasText.height);
    ctx.fillStyle = 'rgba(255, 221, 68, 1)';
    ctx.shadowColor = 'rgba(255, 221, 68, 0.9)';
    ctx.shadowBlur = 15;
    ctx.font = 'bold 80px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, canvasText.width/2, canvasText.height/2);
  }
  drawTextOnCanvas('Elvinimmm seni çok seviyorum balım');

  const textTexture = new THREE.CanvasTexture(canvasText);
  const textMat = new THREE.MeshBasicMaterial({map: textTexture, transparent: true});
  const textMesh = new THREE.Mesh(textGeo, textMat);
  textMesh.position.set(0, 0.7, 0);
  textMesh.rotation.x = -0.2;
  textMesh.visible = false;
  scene.add(textMesh);

  // Kutudan ışık
  const pointLight = new THREE.PointLight(0xffdd44, 2, 5);
  pointLight.position.set(0, 0.6, 0);
  pointLight.visible = false;
  scene.add(pointLight);

  // Animasyon kontrolü
  let opened = false;

  const openBtn = document.getElementById('openBtn');
  openBtn.addEventListener('click', () => {
    if(opened) return;
    opened = true;
    openBtn.disabled = true;

    // Kapağı aç (pivot üzerinden)
    gsap.to(lidPivot.rotation, {
      x: -Math.PI / 2,
      duration: 2,
      ease: "power2.out",
      onComplete: () => {
        // Yazıyı göster ve yukarı çıkmaya başla
        textMesh.visible = true;
        gsap.to(textMesh.position, { y: 2, duration: 3, ease: "power2.out" });
        gsap.to(textMesh.rotation, { y: Math.PI*4, duration: 10, repeat: -1, ease: "linear" });
      }
    });

    // Işık aç
    pointLight.visible = true;

    // Konfeti başlat
    startConfetti();
  });

  // Konfeti fonksiyonu
  function startConfetti() {
    const duration = 5 * 1000;
    const end = Date.now() + duration;
    const colors = ['#ff0', '#f0f', '#0ff', '#0f0', '#f00'];

    (function frame() {
      confetti({
        particleCount: 20,
        spread: 360,
        origin: { y: 0.7 },
        colors: colors
      });
      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
  window.addEventListener('resize', onWindowResize);

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

})();
</script>

</body>
</html>
